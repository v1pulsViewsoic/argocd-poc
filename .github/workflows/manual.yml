name: CI/CD Pipeline

on:
  push:
    branches:
      - main  # Trigger the pipeline on push to the main branch
  pull_request:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Check out repository
      uses: actions/checkout@v2

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v2

    - name: Log in to Docker Hub
      uses: docker/login-action@v2
      with:
        username: ${{ secrets.DOCKER_USERNAME }}
        password: ${{ secrets.DOCKER_PASSWORD }}

    # - name: Build Docker image
    #   run: |
    #     docker build -t <your-docker-username>/django-app:${{ github.sha }} .
    
    # - name: Push Docker image to Docker Hub
    #   run: |
    #     docker push <your-docker-username>/django-app:${{ github.sha }}

    # - name: Update Kubernetes deployment with new image
    #   run: |
    #     kubectl set image deployment/django-app django=<your-docker-username>/django-app:${{ github.sha }} -n default
    #     kubectl rollout status deployment/django-app -n default

    # - name: Sync ArgoCD Application
    #   run: |
    #     argocd app sync django-app --auth-token ${{ secrets.ARGOCD_AUTH_TOKEN }}
